-- MySQL Script generated by MySQL Workbench
-- Wed Sep  1 01:24:55 2021
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema Twitter
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema Twitter
-- -----------------------------------------------------
CREATE database Twitter;
USE Twitter ;

select * from mysql.component;
INSTALL COMPONENT 'file://component_validate_password';
show variables like 'validate_password';
-- -----------------------------------------------------
-- Table `Twitter`.`Acconts`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `Twitter`.`Acconts` ( -- creating the account table which has the info of the user 
  `username` VARCHAR(20) NOT NULL,
  `Phone` VARCHAR(15) NOT NULL,
  `Email` VARCHAR(45) NOT NULL,
  `Password` varchar(64) NOT NULL,
  `Country` VARCHAR(45) NOT NULL,
  `Gender` VARCHAR(45) NOT NULL,
  `Birthday` date NOT NULL,
  PRIMARY KEY (`username`),
  UNIQUE INDEX `username_UNIQUE` (`username` ASC) VISIBLE);

insert into acconts values
 ('kitkat', '0595916651','ziad.toon@gmail.com', 12345678, 'SA', 'M', '1998-03-10')
,('abod', '0551223213','abod@gmail.com', '123123wqdc#', 'KW', 'M', '1998-03-11')
,('kalodi23', '0501234567','kalodi23@gmail.com', 'skdalsd23', 'SA', 'M', '1998-03-12')
,('ahmed', '0501234568','ahmed@gmail.com', 'sijd123jj', 'EG', 'M', '1998-03-13')
,('inf', '0501234569','inf@gmail.com', 'okdoqw221@@a_$', 'SU', 'F', '1998-03-14')
,('saad', '0501234510','saad@gmail.com', 'sdqdqw23', 'SA', 'M', '1998-03-15')
,('naifco', '0501234511','naifco@gmail.com', '05214jdncfh#', 'SA', 'M', '1998-03-16')
,('zenaemaad', '0501234512','zenaemaad@gmail.com', 'dji8jkkndkq#', 'SA', 'F', '1998-03-17')
,('samiMoments1', '0501234513','samiMoments1@gmail.com', 'sami123q&', 'SA', 'M', '1998-03-18')
,('1iTeacher', '0501234514','1iTeacher@gmail.com', 'teacher054345@#', 'SA', 'M', '1998-03-19')
,('oKM2E4u6cOije5', '0501234529','shahad@gmail.com', 'oKM2E4u6cOije5@password#123', 'KRO', 'F', '1998-06-13')
,('oKM2E4u6cOije6', '0501234530','temo@gmail.com', 'oKM2E4u6cOije6@password#123', 'JPN', 'F', '1998-07-05');
select * from acconts;

update acconts -- password encryption using md5 function
set password = md5(password); 

SET SQL_SAFE_UPDATES = 0;


- -----------------------------------------------------
-- Table `Twitter`.`Profiles`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `Twitter`.`Profiles` (
  `username` VARCHAR(20) NOT NULL,
  `Hidder` BLOB NULL, -- creating the profiles table with picters
  `ProfilePic` BLOB NULL,
  `Name` VARCHAR(50) NULL,
  `Bio` VARCHAR(160) NULL,
  `Location` VARCHAR(30) NOT NULL,
  `Website` VARCHAR(100) NULL,
  
  UNIQUE INDEX `username_UNIQUE` (`username` ASC) VISIBLE,
  INDEX `fk_Profile_Accont_idx` (`username` ASC) VISIBLE,
    FOREIGN KEY (`username`)
    REFERENCES `Twitter`.`Acconts` (`username`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

insert into Profiles values
('kitkat', LOAD_FILE('C:\pics\male.png'), LOAD_FILE('C:\pics\headder.png'), 'kitkaaat' , 'so long bad feeling', 'Riyadh', 'insta/ziyadsub')
,('abod', LOAD_FILE('C:\pics\male.png'), LOAD_FILE('C:\pics\headder.png'), 'abodi' , 'The trip befor arraiving', 'kuwit', 'insta/abod')
,('kalodi23', LOAD_FILE('C:\pics\male.png'), LOAD_FILE('C:\pics\headder.png'), 'kalo' , 'I love the stars', 'Jeddah', 'insta/kalodi23')
,('ahmed', LOAD_FILE('C:\pics\male.png'), LOAD_FILE('C:\pics\headder.png'), 'Q2' , 'أرقّ من أن ألوم وأحنّ من أن أؤذي', 'Alexandria', 'insta/Alexandria')
,('inf', LOAD_FILE('C:\pics\female.png'), LOAD_FILE('C:\pics\headder.png'), 'أنف' , 'the girl who’s always smiling" FASHION - ART', 'Alkhartoom', 'insta/inf')
,('saad', LOAD_FILE('C:\pics\male.png'), LOAD_FILE('C:\pics\headder.png'), 'black' , 'abcdefghijklmnopqrvstupwxyz', 'ALkhobar', 'insta/saad')
,('naifco', LOAD_FILE('C:\pics\male.png'), LOAD_FILE('C:\pics\headder.png'), 'نايفكو' , '| القوة تجذب القوة | Viral content expert | Content is king, distribution is queen | Naif Madkhali | naif@naifco.me |', 'Riyadh', 'snapchat.com/add/naifbox')
,('zenaemaad', LOAD_FILE('C:\pics\female.png'), LOAD_FILE('C:\pics\headder.png'), 'زيناعماد' , 'mother of mountains ', 'Jeddah', 'insta/zenaemaad')
,('samiMoments1', LOAD_FILE('C:\pics\male.png'), LOAD_FILE('C:\pics\headder.png'), 'ميكي موسى' , 'Dont be so stupid', 'Qasseem', 'insta/samimomets')
,('1iTeacher', LOAD_FILE('C:\pics\male.png'), LOAD_FILE('C:\pics\headder.png'), 'TheTeacher' , 'اهلا وسهلا', 'Riyadh', 'insta/1iTeacher')
,('oKM2E4u6cOije5', LOAD_FILE('C:\pics\female.png'), LOAD_FILE('C:\pics\headder.png'), 'Shahad' , 'Hello', 'seol', 'myWibsite.com')
,('oKM2E4u6cOije6', LOAD_FILE('C:\pics\female.png'), LOAD_FILE('C:\pics\headder.png'), 'Temo' , 'Mother of memes', 'Tokeyo', 'RacconsWorld.com');
select * from Profiles;

-- -----------------------------------------------------
-- Table `Twitter`.`Following`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `Twitter`.`Following` (  -- creating the table of following/followers that came from many-to-many relationship.
  `username` VARCHAR(20) NOT NULL,
  `f_username` VARCHAR(20) NOT NULL,
  FOREIGN KEY (`username`) REFERENCES `Twitter`.`Acconts` (`username`),
  FOREIGN KEY (`f_username`) REFERENCES `Twitter`.`Acconts` (`username`));
    

insert into following values
('kitkat', 'zenaemaad'),
('zenaemaad', '1iTeacher'),
('1iTeacher', 'kitkat'),
('samiMoments1', '1iTeacher'),
('oKM2E4u6cOije6', 'naifco'),
('kitkat', '1iTeacher'),
('1iTeacher', 'samiMoments1'),
('naifco', 'zenaemaad'),
('samiMoments1', 'zenaemaad'),
('oKM2E4u6cOije5', 'zenaemaad'),
('oKM2E4u6cOije5', 'kitkat'),
('samiMoments1', 'naifco'),
('naifco', 'oKM2E4u6cOije5');

select * from following;
-- -----------------------------------------------------
-- Table `Twitter`.`Tweets`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `Twitter`.`Tweets` (
  `tweet_id` INT auto_increment,
  `tweet_txt` VARCHAR(280) NOT NULL,
  `tweet_pic` BLOB NULL,
  `tweet_date` datetime NOT NULL,
  `username` VARCHAR(20) NULL,
  INDEX `username_idx` (`username` ASC) VISIBLE,
  PRIMARY KEY (`tweet_id`),
  UNIQUE INDEX `tweet_id_UNIQUE` (`tweet_id` ASC) VISIBLE,
  CONSTRAINT `username`
    FOREIGN KEY (`username`)
    REFERENCES `Twitter`.`Profiles` (`username`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

insert into tweets(tweet_txt, tweet_pic, tweet_date, username) values
('They got there early, and they got really good seats.', '', CURRENT_TIMESTAMP, 'kitkat'),
('It\'s difficult to understand the lengths he\'d go to remain short.', '', CURRENT_TIMESTAMP, 'kitkat'),
('He set out for a short walk, but now all he could see were mangroves and water were for miles.', '', CURRENT_TIMESTAMP, 'zenaemaad'),
('Sometimes, all you need to do is completely make an ass of yourself and laugh it off to realise that life isn’t so bad after all.', '', CURRENT_TIMESTAMP, 'zenaemaad'),
('With a single flip of the coin, his life changed forever.', '', CURRENT_TIMESTAMP, '1iTeacher'),
('We need to rent a room for our party.', '', CURRENT_TIMESTAMP, '1iTeacher'),
('The pet shop stocks everything you need to keep your anaconda happy.', '', CURRENT_TIMESTAMP, 'oKM2E4u6cOije6'),
('The fog was so dense even a laser decided it wasn\'t worth the effort.', '', CURRENT_TIMESTAMP, 'oKM2E4u6cOije6'),
('his seven-layer cake only had six layers.', '', CURRENT_TIMESTAMP, 'naifco'),
('Flying fish few by the space station.', '', CURRENT_TIMESTAMP, 'naifco'),
('The gloves protect my feet from excess work.', '', CURRENT_TIMESTAMP, 'samiMoments1'),
('The three-year-old girl ran down the beach as the kite flew behind her.', '', CURRENT_TIMESTAMP, 'samiMoments1'),
('The most exciting eureka moment I\'ve had was when I realized that the instructions on food packets were just guidelines.', '', CURRENT_TIMESTAMP, 'kalodi23'),
('As the asteroid hurtled toward earth, Becky was upset her dentist appointment had been canceled.', '', CURRENT_TIMESTAMP, 'kalodi23'),
('In the end, he realized he could see sound and hear words.', '', CURRENT_TIMESTAMP, 'abod');


select * from tweets;

-- -----------------------------------------------------
-- Table `Twitter`.`Profiles_has_Tweets`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `Twitter`.`Profiles_has_Tweets` (
  `Profiles_username` VARCHAR(20) NOT NULL,
  `Tweets_tweet_id` INT NOT NULL,
    FOREIGN KEY (`Profiles_username`)
    REFERENCES `Twitter`.`Profiles` (`username`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,

    FOREIGN KEY (`Tweets_tweet_id`)
    REFERENCES `Twitter`.`Tweets` (`tweet_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);
    
    
    insert into Profiles_has_Tweets values
    ('kitkat', 1),
    ('kitkat', 2),
    ('zenaemaad', 3),
    ('zenaemaad', 4),
    ('1iTeacher', 5),
    ('1iTeacher', 6),
    ('oKM2E4u6cOije6', 7),
    ('oKM2E4u6cOije6', 8),
    ('naifco', 7),
    ('naifco', 7),
    ('samiMoments1', 7),
    ('samiMoments1', 7),
    ('kalodi23', 7),
    ('kalodi23', 7),
    ('abod', 7);

select * from Profiles_has_Tweets;
-- -----------------------------------------------------
-- Table `Twitter`.`Likes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `Twitter`.`Likes` (
  `Profiles_username` VARCHAR(20) NOT NULL,
  `Tweets_tweet_id` INT NOT NULL,
  CONSTRAINT `fk_Profiles_has_Tweets1_Profiles1`
    FOREIGN KEY (`Profiles_username`)
    REFERENCES `Twitter`.`Profiles` (`username`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
    
  CONSTRAINT `fk_Profiles_has_Tweets1_Tweets1`
    FOREIGN KEY (`Tweets_tweet_id`)
    REFERENCES `Twitter`.`Tweets` (`tweet_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);
select * from likes;
insert into likes values
('kalodi23', 1),
('zenaemaad', 1),
('naifco', 1),
('samiMoments1', 1),
('kitkat', 2),
('samiMoments1', 2),
('kalodi23', 2),
('naifco', 2),
('abod', 3),
('kitkat', 3),
('oKM2E4u6cOije6', 4),
('kitkat', 5),
('oKM2E4u6cOije6', 5),
('zenaemaad', 6),
('zenaemaad', 6),
('naifco', 7),
('oKM2E4u6cOije6', 8),
('kitkat', 9);



-- -----------------------------------------------------
-- Table `Twitter`.`Retweet`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `Twitter`.`Retweet` (
  `Profiles_username` VARCHAR(20) NOT NULL,
  `Tweets_tweet_id` INT NOT NULL,
  
  CONSTRAINT `fk_Profiles_has_Tweets1_Profiles2`
    FOREIGN KEY (`Profiles_username`)
    REFERENCES `Twitter`.`Profiles` (`username`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
    
  CONSTRAINT `fk_Profiles_has_Tweets1_Tweets2`
    FOREIGN KEY (`Tweets_tweet_id`)
    REFERENCES `Twitter`.`Tweets` (`tweet_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);
    
 
    
    insert into retweet values
    ('kitkat', 8),
    ('oKM2E4u6cOije6', 7),
    ('kalodi23', 6),
    ('kalodi23', 5),
    ('zenaemaad', 4),
    ('naifco', 3),
    ('abod', 1);
    
   select * from retweet;
/* 
   DELIMITER // -- creating a proceduer to create an account and its profile 
create procedure createAccount(username varchar(20), phone varchar(15), Email varchar(45), password varchar(64), Country varchar(45), Gender varchar(1), birthday date, hidder Blob, pro_pic blob, name varchar(50), bio varchar(160), location varchar(30), web varchar(100))
begin 
insert into acconts values(username, phone, Email, md5(password), Country, Gender, birthday);
insert into profiles values(username, hidder, pro_pic, name, bio, location, web);
end;

DELIMITER //
create procedure user_follow(username varchar(20), fusername varchar(20))
begin 
insert into following values(username, fusername);
end;
*/


select * from acconts;
select * from profiles;

-- adding into account and profile tables with proceduer  
call createAccount('bander', 0501234567, 'bander@gmail.com', 'banderx212@passowrd', 'SA', 'M', '2000-05-12', LOAD_FILE('C:\pics\header.png'), LOAD_FILE('C:\pics\male.png'), 'Bndora',  'So long and thanks for the fish.', 'Riyadh', 'bander.ksa.com');

select count(Profiles_username) from Profiles_has_Tweets where Profiles_username = 'kitkat'; -- to show the number of tweets a user has..


